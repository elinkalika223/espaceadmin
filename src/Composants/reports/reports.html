<div class="reports-container">
  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Chargement des données...</p>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error && !isLoading" class="error-message">
    <p>⚠️ {{ error }}</p>
  </div>

  <!-- En-tête avec titre et actions -->
  <div class="reports-header">
    <h2 class="section-title">Rapports CPN/CPON</h2>
    <div class="header-actions">
      <button class="btn-export-red" (click)="exportReport('excel')">
        <i class="fas fa-file-alt"></i>
        Exporter
      </button>
      <div class="year-selector">
        <select 
          [(ngModel)]="selectedYear" 
          (change)="filterByYear(selectedYear)" 
          class="year-select"
          title="Sélectionner une année">
          <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
        </select>
        <i class="fas fa-chevron-down"></i>
      </div>
    </div>
  </div>

  <!-- Cartes KPIs -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">TOTAL PATIENTES</div>
      <div class="kpi-value kpi-green">{{ kpiData.totalPatientes }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">CONSULTATIONS</div>
      <div class="kpi-value kpi-pink">{{ kpiData.totalConsultations }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">ACCOUCHEMENTS</div>
      <div class="kpi-value kpi-green">{{ kpiData.totalAccouchements }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">TAUX SUIVI</div>
      <div class="kpi-value kpi-pink">{{ kpiData.tauxSuivi }}%</div>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="charts-grid">
    <!-- Graphique Donut - Répartition CPN/CPON -->
    <div class="chart-card">
      <h3 class="chart-title">Répartition CPN/CPON</h3>
      <div class="chart-container">
        <canvas id="repartitionChart"></canvas>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color legend-green"></span>
          <span class="legend-text">CPN Réalisées</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-blue"></span>
          <span class="legend-text">CPON Réalisées</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-purple"></span>
          <span class="legend-text">CPN Manquées</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-red"></span>
          <span class="legend-text">CPON Manquées</span>
        </div>
      </div>
    </div>

    <!-- Graphique Barres - CPN par trimestre -->
    <div class="chart-card">
      <h3 class="chart-title">CPN par trimestre de grossesse</h3>
      <div class="chart-container">
        <canvas id="trimestreChart"></canvas>
      </div>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color legend-green"></span>
          <span class="legend-text">CPN Réalisées</span>
        </div>
        <div class="legend-item">
          <span class="legend-color legend-red"></span>
          <span class="legend-text">CPN Manquées</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau mensuel -->
  <div class="table-card">
    <h3 class="table-title">Détails des consultations par mois ({{ selectedYear }})</h3>
    <div class="table-container">
      <table class="monthly-table">
        <thead>
          <tr>
            <th>Mois</th>
            <th>CPN Réalisées</th>
            <th>CPN Manquées</th>
            <th>CPON Réalisées</th>
            <th>CPON Manquées</th>
            <th>Taux de réussite</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let month of monthlyData">
            <td class="month-name">{{ month.nom }}</td>
            <td>{{ month.cpnRealisees }}</td>
            <td>{{ month.cpnManquees }}</td>
            <td>{{ month.cponRealisees }}</td>
            <td>{{ month.cponManquees }}</td>
            <td class="success-rate">{{ month.tauxReussite }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
